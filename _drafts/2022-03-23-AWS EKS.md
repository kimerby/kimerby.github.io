---
title: "EKS on AWS"
date: 2022-03-23T09:00:00+09:00
categories:
  - AWS
tags:
  - Cloud
  - AWS
  - EKS
toc: true
toc_sticky: true
toc_label: "목차"
---

# 1. 컨테이너 기본 개념

# 1.1 배경
  1.  모놀리식
  - 모듈간 강력한 결합

  2. 과도기 SOA
  - SOAP(XLM) 기반
  - API는 분리했지만, 데이터베이스를 동일하게 사용하다보니 문제 발생

  3. 마이크로서비스
  - 데이터베이스르 다 분리함
  - 비동기처리(ASYNC)가 발달함 > 트랜잭션 롤백처럼 작동하기 쉬워짐
  - REST API
  - API는 가능한 단순하게 만들 것(그래야 변화가 없음)

  4. 코드리뷰 (참조)
  - 가독성 (다른 사람도 코드를 이해할 수 있는지?)
  - 테스트 코드 작성 잘 되어있는지
  - 실행코드는 상대적으로 덜 봐도 된다

# 1.2 컨테이너란?
- 하나의 표준화된 유닛
- 코드가 독립된 환경에서 수행하고 있다고 속이는 것
- 마이크로서비스에 이상적  

# 1.3 장점
  - 확장성: 도구, 아키텍처, 또는 개발 실무에 큰 변화 없이 확장 가능
  - 지속적 배포 가능

# 1.4 구성요소
  - 컨테이너 이미지
  - Dockerfile 작성: FROM > RUN > ...
  - 컨테이너 런타임: 호스트 시스템 리소스의 실행 컨테이너와의 공유 관리

# 1.5 Docker
- 컨테이너 가상화 엔진
- Linux 기반 cgroup을 편하게 사용하는 유틸리티

# 1.6 Docker 용어집
- Dockerfile: Docker 이미지를 빌드하는 데 사용
- 이미지: 런타임 시 Docker 컨테이너용 파일
- 레지스트리: Docker 이미지에 대한 버전 관리 시스템(중앙 집중식 이미지 리포지토리)
- 컨테이너: 실행 가능한 이미지 인스턴스
- 호스트: 컨테이너를 실행(또는 호스트)하는 머신

# 1.7 DevOps 아키텍처
![DevOps Architecture]()*DevOps Architecture*

# 2. 쿠버네티스 기본 개념

# 2.1 기초 개념
1. 클러스터: 하나의 스세틈으로 함께 작동하는 여러 개의 서버나 인스턴스의 집합

2. 클러스터를 관리하기 위해 확인해야 할 사항
  - 어느 인스턴스에 메모리나 포트와 같이 사용 가능한 리소스가 있습니까?
  - 컨테이너가 언제 죽습니까?
  - 로드 밸런서에 어떻게 연결합니까?
  - 지속적 통합 및 지속적 전달(CI/CD)을 어떻게 촉진합니까?
  다시 말해서, 컨테이너를 규모에 맞게 관리하는 방법을 알아야 함

3. 컨테이너 오케스트레이션 도구
  - 스케줄링
  - 배치
  - 클라우드
  - 네트워킹
  - 로드 밸런싱
  - 스토리지
  - 보안
  - 모니터링
  - 로깅

# 2.1 쿠버네티스 장점
  - 이동성
  - 확장성
  - 지속적 배포
  - 강력한 커뮤니티
  - 클라우드 배포 가능
  - 선언형 (간결한 인프라 구성, 동일 템플릿 재사용, 상태유지 포함)

# 2.2 쿠버네티스 객체
  - Pod:
    - 1개 이상의 컨테이너로 구성된 쿠버네티스의 기본 빌딩 그룹
    - 하나의 Pod는 1대의 VM 혹은 물리머신 위에서 구성됨
  - 볼륨: Pod에 종속되는 디스크
  - 서비스: 여러 Pod의 논리적 컬렉션과 여기에 액세스하는 수단 

# 2.3 쿠버네티스 구성요소
  - DaemonSet: 모든 노드가 요청된 Pod의 복사본을 갖도록 해준다. 이 기능은 애플리케이션 코드를 실행하는 Pod에 일반적인 지원 기능(예: 보안, 로깅 모니터링, 또는 백업)을 제공하려는 경우에 유용

# 2.4 쿠버네티스 내부
  - 제어 플레인: 적절한 라우팅에 대한 결정 및 권한(트래픽이 어디로 전송될지 결정)
  - 데이터 플레인: 라우터를 통해 트래픽 전달(트래픽 전송 작업 실행)
  - 노드: 쿠버네티스 클러스터를 실행하는 시스템, 서버 인스턴스
  (제어 플레인 노드는 클러스터 자체를 관리, 데이터 플레인 노드는 애플리케이션 실행)
  - 컨트롤러: 현재 상태가 원하는 상태와 같아지게 해줌 (=제어 루프)
    (컨트롤러 예: deployments, ReplicaSet, DaemonSet)
  - kubelet: Pod에 올바른 컨테이너가 실행되게 해주고 그 컨테이너가 정상 상태가 되게 해줌
    1. 노드에 할당된 Pod를 감시(제어 플레인의 API서버 또는 로컬 구성 파일을 통해)
    2. 필요한 볼륨을 탑재
    3. 보안 암호를 다운로드
    4. Docker를 사용하여 Pod의 컨테이너를 실행
    5. 요청된 컨테이너의 liveness probes 또는 상태 검사를 주기적으로 실행
    6. 노드의 상태를 나머지 시스템에 보고
  - kubectl: 특정 클러스터에서 Kubernetes API 서버와 통신하기위한 명령줄 인터페이스(CLI). 플레인 노드와 통신할 수 있음.
    kubectl[명령][유형][이름][플래그]
    - 명령: 수행할 작업을 지정
    - 유형: 리소스 유형을 지정
    - 이름: 리소스 이름을 지정
    - 플래그: 선택적 플래그 지정

# 2.5 쿠버네티스 오브젝트 설명
EKS를 공부하는데 가장 좋은 사이트: https://www.eksworkshop.com/

- Architecture overview
![Overview](/images/aws/eks/architecture_overview.png)*Overview*

***

# 3. EKS 기본개념


# 4. Amazon EKS 클러스터 구축


# 5. Amazon EKS 클러스터에 애플리케이션 배포


# 6. Amazon EKS에서 관찰 기능(observability) 구성

# 6.1 관찰 기능이란?
데이터 또는 프로세스를 분석하고 볼 수 있는 기능
  - Pod 및 컨테이너
  - 애플리케이션
  - 컴퓨팅 리소스

3대 핵심 요소
  - 지표
  - 로그
  - 추적

Prometheus

#7. Amazon EKS에서 효율성, 복원력, 비용 최적화 간의 균형 유지