---
title: "Architecting on AWS"
date: 2022-03-20T14:00:00+09:00
categories:
  - AWS
tags:
  - cloud
  - AWS
  - Architect
toc: true
toc_sticky: true
toc_label: "목차"
---

# 1. 개요  

- **클라우드 컴퓨팅의 여섯 가지 장점**
  - 자본 비용을 가변 비용으로 대체
  - 규모의 경제로 얻게 되는 이점
  - 용량 추정 불필요
  - 속도 및 민첩성 개선
  - 중요한 문제에 집중
  - 몇 분 만에 세계에 배포  
- **Well-Architected Framework 다섯 가지 핵심 요소**
  - 보안
  - 안정성
  - 비용 최적화
  - 성능 효율성
  - 운영 탁월성  

***


- **AWS 가용 영역**
  - 하나 이상의 데이터 센터로 구성
  - 내결함성을 갖도록 설계
  - 프라이빗 링크를 통해 다른 가용 영역과 상호 연결
  - 사용자가 선택 가능
- **AWS 리전**
  - 각 리전은 두 개 이상의 가용 영역으로 이루어져 있음
  - 리전 간 데이터 복제를 활성화하고 제어할 수 있음
  - 리전 간 통신은 AWS 백본 네트워크 인프라를 사용
- **엣지 로케이션**
  - 최종 사용자에게 더 짧은 지연 시간으로 콘텐츠를 전송하기 위함
  - Route53 및 CloudFront와 같은 서비스를 지원
  - 리전 엣지 캐시 : 오리진 서버에서 컨텐츠를 가져오지 않아도 되는 대안 제공(자주 액세스 안하는 컨텐츠)

![Edge Location](https://d1.awsstatic.com/global-infrastructure/maps/Cloudfront-Map_9.24_2x.2eeac6e52bf404816c6d0aac3edbeb7b6b87fdaa.png)*Edge Location*  

***
# 2. 간단한 아키텍쳐
## 2.1 S3
- Object Storage
- 필요한만큼 저장 가능(개별 객체는 5TB 제한)
- AWS MC, API, SDK를 통해 액세스 가능
- 이벤트 트리거 사용 가능
- **사용사례 1. 정적 웹 컨텐츠와 미디어 저장 및 배포**
  - 버킷 정책 : 저장된 객체에 액세서 허용 제어 (ACL 정책 보완)
  - 액세스 포인트 : 엔드포인트 사용 (단일 사용자/애플리케이션/사용자 그룹)
- **사용사례 2. 정적 웹사이트 호스팅**
  - 버전 관리
  - CORS(Cross Origin Resource Sharing) : 한 도메인에서 로드되어 있는 클라이언트 웹 애플리케이션이 다른 도메인에 있는 리소스와 상호작용하는 방법을 정의
다음을 식별하는 규칙을 포함하는 XML 문서 생성
    - 액세스 허용할 오리진
    - 각 오리진에 지원할 작업(HTTP 메서드)
    - 기타 작업별 정보 
- **사용사례 3. 연산 및 대규모 분석용 데이터 스토어**
- **사용사례 4. 백업 도구(업로드)**
  - S3 Transfer Acceleration: 사용자 파일-엣지 로케이션까지는 인터넷, 엣지 로케이션-S3까지는 백본 네트워크
  - AWS Snowball(페타바이트)
  - AWS Snowmobile(엑사바이트)  

***
- 모범 사용 사례
  - 한 번 쓰고 여러 번 읽어야 하는 경우
  - 데이터 엑세스가 일시적으로 급증
  - 사용자가 매우 많고 콘텐츠 양이 다양
  - 데이터 세트가 계속 증가
- 이상적인 사용사례가 아닌 경우
  - 블록 스토리지 요구 사항
  - 자주 바뀌는 데이터
  - 장기 아카이브 스토리지  

***
- Amazon S3 비용 지불
  - 월별 GB
  - 다른 리전 또는 인터넷으로 전송
  - PUT, COPY, POST, LIST 및 GET 요청
  - S3 수신은 지불 대상 아님!
  - 동일 리전내 전송은 지불 대상 아님!  

***  
## 2.2 S3 Glacier
- 장기 데이터 스토리지
- 아카이브 또는 백업
- 매우 저렴한 스토리지  

***
- **리전 선택**
  - 데이터 주권 및 규정 준수
  - 사용자와 데이터 간 근접성
  - 서비스 및 기능 가용성
  - 비용 효율성  

***

# 3. 컴퓨팅 계층 추가
## 3.1 EC2
- 웹 호스팅
- 데이터베이스
- 인증
- 서버가 처리할 수 있는 모든 것
- **AMI(Amazon Machine Image)** 
  - OS에 설치된 모든 구성요소 포함
  - 사전 구축 / AWS Marketplace / 자체 생성 가능
  - 장점 : 반복성, 재사용성, 복구성, Marketplace 솔루션, 백업  
***
- **Amazon EBS(Elastic Block Store)**
  - 애플리케이션에는 블록 수준 스토리지가 필요함
  - 인스턴스 스토어는 휘발성
  - 종료 후에도 데이터 지속
  - 데이터 볼륨을 백업할 수 있음
  - Instance : EBS = 1 : N !!!
  - EBS 유형 : SSD, HDD
- **Amazon Elastic File System(EFS)**
  - 공유 엑세스 : 가용영역, 리전, VPC, AWS 계정
- **Amazon FSx**
  -  공유 액세스: AWS 계정, VPC, AWS 리전  
***
- **EC2 Instance 유형**
  - 이름 의미: m5large = 패밀리이름/세대번호/인스턴스 크기
  1. 범용 (T2)
  2. 컴퓨팅 최적화 (C5)
  3. 메모리 최적화 (R4)
  4. 가속화된 컴퓨팅 (P3)
  5. 스토리지 최적화 (H1)  
***
- **EC2 요금 옵션**
1. 온디맨드 인스턴스: 즉시 필요한 컴퓨팅 파워 해결
2. 예약 인스턴스: 미리 용량을 예약하여 비용 절감할 수 있음
3. Savings Plans: RI 구매를 조정할 필요가 없음
4. 스팟 인스턴스: 워크로드의 시작 및 중지를 수용하는 한 최고의 할인 제공

- **EC2 전용 옵션**
1. 전용 인스턴스: 다른 AWS 계정과 물리적으로 격리(같은 렉)
2. 전용 호스트: 고객 전용의 EC2 인스턴스 용량을 갖춘 물리적 서버(아예 지정)

- **EC2 테넌시**
1. 기본값: 인스턴스가 공유된 하드웨어에서 실행
2. 전용 인스턴스: 비 특정 하드웨어에서 실행
3. 전용 호스트: 고객이 선택한 특정 하드웨어에서 실행  

***

# 4. 데이터베이스 계층 추가
- 고려사항
  - 확장성
  - 총 스토리지 요구 사항
  - 객체 크기 및 유형
  - 내구성

- 데이터베이스 유형
  - 관계형 (Microsoft SQL Server, Oracle DB, MySQL)
    - 데이터를 행과 열에 저장
    - 스키마 고정되어 있으며, 열은 데이터 입력 전에 잠겨있어야 함
    - SQL 사용
    - 수직적 확장 (하드웨어 성능)
    - 엄격한 규칙 및 데이터 품질 필요 시 사용
    - 데이터베이스가 과도한 읽기/쓰기 용량을 필요로 하지 않을 떄 사용
    - 최상의 성능을 필요로 하지 않을 경우 사용
  - 비관계형 (MongoDB, Cassandra, Redis)
    - 키 값 페어, 문서 및 그래프를 비롯한 다양한 스토리지 모델 저장
    - 동적 스키마, 각 행은 각 열에 대한 데이터를 포함할 필요 없음
    - 문서 수집에 집중
    - 수평적 확장 (하드웨어 성능)
    - I/O 성능이 중요할 경우 사용  
  ***

## 4.1 Amazon RDS(Relational Database Service)
  - 완전 관리형 관게형 데이터베이스 서비스
  - 몇 분이면 새 인스턴스를 프로비저닝
  - 몇 번의 마우스 클릭으로 수직 조정
  - 적합한 애플리케이션
    - 복잡한 데이터 사용 시
    - 데이터 세트를 결합하고 연결할 때
    - 구문 규칙을 적용해야 할 때
  
## 4.2 Amazon Aurora
  - MySQL 및 PostgreSQL과 호환되는 완전 관리형 관계형 데이터베이스  엔진
  - MySQL 처리량의 최대 5배
  - PostgreSQL 처리량의 최대 3배
  - 3개의 가용 영역에 6개의 복제본
  - 기존 애플리케이션을 최소한으로 변경
  - Aurora 글로벌 데이터베이스 지원

## 4.3 Amazon DynamoDB
  - 완전 관리형 비관계형 데이터베이스 서비스
  - 이벤트 중심 프로그래밍(서버리스 컴퓨팅)
  - 최상의 수평 확장 가능
  - 적합한 애플리케이션
    - 대용량의 단순 데이터 보유
    - 신속하고 간편하게 확장해야 함
    - 복잡한 조인이 필요하지 않음

  - 글로벌 테이블: 단일 AWS 계정이 소유하고 복제본 테이블로 식별되는 한 개 이상의 DynamoDB 테이블의 모음
  - 일관성 옵션: 최종 일관성 or 강력한 일관성  
***

## 4.4 보안 제어
- Amazon RDS 보안 제어
  - 몇 가지 고려할 사항
  1. DB 자체에 대한 액세스
  : 누가 가시성을 보유하고 데이터베이스에 대한 작업을 실행할 수 있는가?
  2. 저장 시 암호화
  : 저장 시 암호화되는 데이터에는 DB 인스턴스에 대한 기본 스토리지, 자동 백업, 읽기 전용 복제본, 스냅샷이 포함됩니다.
  3. 전송 중 암호화
  : 전송 중 암호화는 SSL을 사용하여 수행할 수 있습니다.
  4. 이벤트 알림
  : Amazon RDS 인스턴스에서 발생할 수 있는 다양한 중요 이벤트에 대한 알림을 받을 수 있습니다.

- Amazon DynamoDB 보안 제어
  - 몇 가지 고려할 사항
  1. 정의 가능한 액세스 권한
  : DynamoDB에서는 데이터베이스의 테이블에서 항목, 심지어 속성까지 모든 것에 대해 액세스 권한을 부여할 수 있습니다.
  2. 저장 시 암호화
  : DynamoDB는 완전 관리형 저장 암호화 기능을 제공합니다.
  3. SSL/TLS 
  : 기본적으로 DynamoDB와의 통신은 SSL/TLS 암호화를 사용하여 네트워크 트래픽을 보호하는 HTTPS 프로토콜을 사용합니다.
  4. 고객 관리형 키
  : DynamoDB 데이터의 보안을 암호화하고 관리하는 방법을 완벽하게 제어할 수 있습니다.  
***
- AWS Database Migration Service(AWS DMS)
  - 대부분의 상용 및 오픈 소스 데이터베이스와의 마이그레이션 지원
  - EC2, RDS, S3 및 온프레미스의 데이터베이스 간 마이그레이션에 사용 가능
  - 옵션 : 일회성 마이그레이션, 지속적 마이그레이션
  - 마이그레이션이 힘든 경우, AWS Snowball Edge를 권장

***

# 5. AWS기반 네트워킹(1)

## 5.1 VPC
- VPC 란?
  - AWS Cloud의 프라이빗 네트워크 공간
  - 워크로드에 대한 논리적 격리 제공
  - 리소스에 대한 사용자 지정 액세스 제어 및 보안 설정 허용
- 세부 사항
  - AWS 계정 전용 가상 네트워크
  - IPv4 또는 IPv6 주소 범위에 존재
  - 점유 리소스에 대한 특정 CIDR 범위를 생성할 수 있음
  - 인바운드 및 아운바운드 트래픽에 대한 엄격한 액세스 규칙 제공
- 배포
  - VPC는 AWS 리전 중 1개 리전에 배포
  - VPC 리전 내 모든 가용 영역의 리소스를 호스팅 할 수 있음
- 다중 VPC 패턴이 적합한 케이스
  - 단일 팀 또는 단일 조직
  - 더 쉽게 표준 상태를 유지하고 액세스를 관리할 수 있는 제한된 팀
- 복수 계정 패턴이 적합한 케이스
  - 대규모 조직 및 여러 IT팀이 있는 조직
  - 빠른 성장이 예상되는 중간 규모의 조직
  - 사유: 단일 계정은 액세스 및 표준 관리가 어려워짐
- VPC 제한
  - 동일한 리전 또는 다른 리전에 여러 VPC를 보유할 수 있음(제한: 계정당 리전당 VPC 5개)
- IP 주소 지정
  - 각 VPC는 사용자가 지정하는 프라이빗 IP 주소의 범위를 예약
  - CIDR(Classless Inter-Domain Routing)표기법 사용하여 정의  
   예) 10.22.0.0/16 = 10.22.*.* (총 IP = 65,536)
- 서브넷을 사용하여 VPC 분리
  - 서브넷은 리소스 그룹을 격리할 수 있는 VPC IP 주소 범위의 세그먼트 또는 파티션
  - 서브넷은 특정 가용 영역에 매핑
- 서브넷 키 속성
  - VPC CIDR 블록의 하위 집합
  - CIDR 블록은 중첩될 수 없음
  - 각 서브넷은 하나의 가용 영역 내에서만 존재함
  - 가용 영역에 서브넷 여러 개 포함될 수 있음 
  - AWS는 각 서브넷에서 5개의 IP주소를 예약
- 네트워크 격리
  - 퍼블릭 인터넷
    - 퍼블릭 인터넷 게이트웨이에 대한 라우팅 테이블 항목을 포함
  - 프라이빗 서브넷
    - 인터넷 게이트웨이에 대한 라우팅 테이블 항목이 없음
    - 퍼블릭 인터넷에 직접 액세스 할 수 없음
    - 제한된 아웃바운드 퍼블릭 인터넷 액세스를 지원하기 위해 NAT 게이트웨이 사용  

## 5.2 라우팅 테이블
  - VPC 리소스 간에 트래픽을 연결하는 데 필요
  - 각 VPC에는 주요(기본) 라우팅 테이블 존재
  - 사용자 지정 라우팅 테이블 생성 가능
  - 모든 서브넷에는 연결된 라우팅 테이블이 있어야 함
## 5.3 인터넷 게이트웨이
  - 퍼블릭 서브넷에 인터넷 연결
  - VPC 인스턴스와 인터넷 간에 통신 허용
  - 가용성이 뛰어나고, 중복적이며, 수평적 확장
  - 인터넷으로 라우팅 가능한 트래픽에 대해 서브넷 라우팅 테이블에 대상을 제공
## 5.4 NAT 게이트웨이
  - 프라이빗 서브넷에 인터넷 연결
  - 프라이빗 서브넷의 인스턴스가 인터넷 또는 다른 AWS 서비스로의 아웃바운드 트래픽을 시작하도록 활성화
  - 프라이빗 인스턴스가 인터넷에서 인바운드 트래픽을 수신하는 것 차단
## 5.5 보안 그룹
  - AWS 리소스에 대한 인바운드 및 아운바운드 트래픽을 제어하는 가상 방화벽
  - 트래픽은 모든 IP 프로토콜, 포트 또는 IP 주소로 제한될 수 있음
  - 규칙은 상태 저장
## 5.6 네트워크 ACL(액세스 제어 목록)
  - 서브넷 경계의 방화벽
  - 기본적으로 모든 인바운드 및 아웃바운드 트래픽을 허용
  - 상태 비저장 이므로 인바운드 및 아운바운드 트래픽 모두에 대한 명시적인 규칙이 필요  

***

# 6. AWS기반 네트워킹(2)

